# RMC-NTM耦合临界计算代码
---
* 主讲人：小马哥
* 时间：2020/1/27 21：30-22：00
---

[TOC]

## Cal_NTMCoupleCritical函数
* 全初始化函数initialAll
* 最大计算步数，一般10次，与
* iterGeometry记录动态几何，读入cGeometry，是从输入卡传入的几何
* 截面初始化，用TMS,resize操作
* NucFisQ裂变能，这里用的定值输入，一般需要实验定下，一般变化不大，180~190MeV左右
* 并行，加入如果是主核判断，只让主核进行某些操作，比如输出信息、进行汇总的简单计算，这里有初始化功率松弛的P_old
* 进入迭代
  * 判断：如果不是第一次迭代，需要做动态几何更新
  * 进入cycle循环和NeuNum循环
  * 随机数生成，之后是每个中子的计算
  * UFS没有用，不用看
  * ProcessCycleEnd处理结果
  * 收敛判据：平均功率方差，最大功率方差，最大迭代次数，前两个需要打开enable，现在一般是最大迭代次数结束程序
* WritePowerHPR
  * 主核将功率文件写入cellTally
  * 提交ANSYS计算并不断check
  * 同步告知所有核信息
  * 目前提交APDL后所有核是处于空转状态，RMC十分钟，APDL五小时，效率比较低，但是又不能释放核，不能关掉RMC，这需要考虑
* check得知APDL计算完毕，得到APDL结果，返回迭代循环，Read_TH读取新信息构建新几何，重复迭代操作