# RMC临界计算代码培训
---
* 主讲人：小马哥
* 时间：2020/1/26 21:00-22:00
---
[TOC]

## 进入临界计算模式
* 开并行
* initialAll，全初始化函数（在核热力耦合中也用到），可以初始化中子输运、几何、材料、截面等等
* 截面展宽分为GaussHermit展宽和TMS展宽两种，我们现在用TMS
* 很大的for循环
  * cycle循环，中子数循环
  * p_bRestart是计算完总代数后再计算，主要用于临界搜索中，现在用不到
  * Tally计数器分解，是用于提高效率的，现在可不看
  * openMP和MPI的计算，OpenMP是用于共享内存系统的多线程程序设计的库，见这个[博客](https://blog.csdn.net/yu132563/article/details/83501870)
  * 进程和线程的区别，见这个[博客](https://www.cnblogs.com/paoqi/p/10887728.html)，节点内存有限的时候，可能牺牲线程换取内存，关于线程和进程，在计算燃耗的时候有用
* 代码主体部分
  * CDParticleState类存储粒子信息
  * SampleFisSource抽样裂变源，得到出射方向、能量、角度、权重等信息，是粒子的“出生地”，粒子如何出生，就是通过抽样裂变源得到的
  * 裂变源分布最开始是假设的（比如平分布），不合理的。因此为了让中子“合理地出生”，需要设置非活跃代，先通过多个cycle计算构建合理的裂变源分布，裂变源分布是一个cycle间传承的信息（类似于贝叶斯，通过先验分布及本次观察获得后验分布），是在变化更新着的，当数代之后，裂变源分布合理后，这时候中子“合理出生”，我们才将主要注意力转移到中子出生后的历史追踪上。
    * 输入卡中每代中子数的意思就是每次从裂变源从抽取多少中子来实验，如population=10000就是每次从当前裂变源分布（以前代代积累下来的）下抽10000个
    * 当进入活跃代后（中子以合理的方式/分布出生后），开始追踪中子历史，记录从生到死的历程
  * 即出生了后，进入TrackHistory
    * TrackHistory及其子函数是最重要的
    * 几何追踪几何GeometryTracking_TMS，自由程抽样sampleFlyDist_TMS自由程抽样，需要在线截面展宽TMS
    * 抽样碰撞反应类型，散射，吸收，裂变等
    * 逐个中子进行追踪

## 重点函数
* TrackHistory  中子历史跟踪
* GeometryTracking_TMS  几何跟踪
* sampleFlyDist_TMS 抽样自由程